# TeslaMate Backup

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL –¥–ª—è TeslaMate —Å –ø–æ–º–æ—â—å—é Docker –∏ `cron`.

---

## üîß –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üïí –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π `pg_dump` –≤ 03:00 –ø–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏
- üíæ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–º–ø—ã –≤ `./backups/`
- ‚ôªÔ∏è –£–¥–∞–ª—è–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
- üìã –õ–æ–≥–∏ `cron` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `./backups/logs/cron.log`

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
teslamate-backup/
‚îú‚îÄ‚îÄ Dockerfile.backup         # –û–±—Ä–∞–∑ –Ω–∞ –±–∞–∑–µ postgres + cron
‚îú‚îÄ‚îÄ backup-cron               # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (cron)
‚îú‚îÄ‚îÄ docker-compose.yml        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Compose
‚îú‚îÄ‚îÄ entrypoint.sh             # –ó–∞–ø—É—Å–∫ cron –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ backups/                  # –ü–∞–ø–∫–∞ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ logs/                 # –õ–æ–≥–∏ cron
```

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/AxeKatyshkin/teslamate-backup.git
cd teslamate-backup

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p backups/logs

# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose build backup
docker-compose up -d backup
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
docker ps | grep backup

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ cron
docker logs -f teslamate-backup

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ –±—ç–∫–∞–ø–∞
ls -lh backups/
```

---

## üßπ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

–£–¥–∞–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ `cron`:

```cron
0 3 * * * pg_dump -U teslamate -h database -d teslamate > /backups/teslamate_$(date +\%F_\%H-\%M-\%S).sql && find /backups -type f -name "*.sql" -mtime +7 -delete >> /backups/logs/cron.log 2>&1
```

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ `root` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ `cron`, –ª–æ–≥–∞–º –∏ `pg_dump`.
- –í—Å–µ `.sql` —Ñ–∞–π–ª—ã –∏ –ª–æ–≥–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `.gitignore`.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–±—Ä–∞–∑ `postgres` —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º `cron`.

---

üõ°Ô∏è –ü—Ä–æ–µ–∫—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã TeslaMate.
